#!/usr/bin/env ruby
require 'rubygems'
require 'optparse'
$: << File.join(File.expand_path(File.dirname(__FILE__)),'..','lib')
require 'backup'
require 'backup_configuration'
require File.join(File.dirname(__FILE__),'..','yarb_version')
USAGE_MESSAGE = %Q{

This backup utility lets you make a backup through a simple 
configuration file 

usage #{$0} [options]
where options are:
}

def usage(parser) 
    puts parser
    exit(1)
end
    
    
def version
	puts Yarb::VERSION; exit(1)
end

recipe_file = nil
parser = OptionParser.new do |opts|
    opts.banner = USAGE_MESSAGE
    opts.on("-h", '--help', "show this message") { usage(parser) }
    opts.on("-v", '--version', "show version") { version }
    opts.on("-r", '--recipe file', "use recipe (mandatory)") { |file| recipe_file = file }
end 
    
rest = parser.parse ARGV
usage(parser) unless recipe_file

begin
recipe = BackupConfiguration.from_file(recipe_file)  
backup = recipe.backup
backup.run
rescue RuntimeError => e
    $stderr.puts e
    exit 255
end
